BFdata<-read.csv("BodyFat.csv")
outlier<-c()
#Find outliers from quantiles.
sddata<-scale(BFdata[,-1])
sddata<-as.data.frame(sddata)
quartz(16,6)
quartz(16,6)
layout(matrix(c(1,2,2,1,2,2), nrow = 2, ncol = 3, byrow = TRUE))
box1<-Boxplot(sddata,id.method="row",col="lightskyblue2")#draw boxplot
library(car)
box1<-Boxplot(sddata,id.method="row",col="lightskyblue2")#draw boxplot
barplot(table(box1),col="lightskyblue2")#some outliers show in different variables repeatedly
outlier<-c(outlier,39,41,216,175,31,42)
#Find outliers from "Siri's equation"
outdet<-BFdata[,-1]
outdet$error1=495 / outdet$DENSITY - 450-outdet$BODYFAT
quartz(12,6)
par(mfrow=c(1,2))
plot(outdet$error1,pch=20)
box2<-Boxplot(outdet$error1,id.method="row",col="lightskyblue2")
outlier<-c(outlier,96,48)
#Find outliers from BMI formula
outdet$error2=703 * outdet$WEIGHT /outdet$HEIGHT ^ 2-outdet$ADIPOSITY
quartz(12,6)
par(mfrow=c(1,2))
plot(outdet$error2,pch=20)
box3<-Boxplot(outdet$error2,id.method="row",col="lightskyblue2")
#Delete outliers
cleandata=BFdata[-outlier,-c(1,3)]
#Use step() to select models with two-way interactions by AIC and BIC
lm0 <- lm(BODYFAT~1, data=cleandata)
lm1 <- lm(BODYFAT~ .*., data=cleandata)
#AIC
model1= step(lm0, scope = list(upper=lm1), direction = "both",k=2)
#Check assumptions and influential points
quartz(12,6)
par(mfrow = c(2,3))
plot(model1, which  = 1)
plot(model1, which  = 2)
plot(model1, which  = 3)
plot(model1, which  = 4)
plot(model1, which  = 5)
plot(model1, which  = 6)
#meets assumptions well
#BIC
model2=step(lm0, scope = list(upper=lm1), direction = "both",k=log(244))
quartz(12,6)
par(mfrow = c(2,3))
plot(model2, which  = 1)
plot(model2, which  = 2)
plot(model2, which  = 3)
plot(model2, which  = 4)
plot(model2, which  = 5)
plot(model2, which  = 6)
#Use regsubsets() to select one-way models by adjr2, Cp, BIC
leap0= regsubsets(BODYFAT~.,data=cleandata, nvmax = 15)
leapsum = summary(leap0)
quartz(12,6)
par(mfrow=c(1,3), pty="s")
library(leaps)
#Use regsubsets() to select one-way models by adjr2, Cp, BIC
leap0= regsubsets(BODYFAT~.,data=cleandata, nvmax = 15)
leapsum = summary(leap0)
quartz(12,6)
par(mfrow=c(1,3), pty="s")
plot(leap0, scale = "adjr2",col="lightskyblue2")
plot(leap0, scale = "Cp",col="lightskyblue2")
plot(leap0, scale = "bic",col="lightskyblue2")
#From this plot:
#adjr2
model3 = lm(BODYFAT~AGE +HEIGHT+NECK+HIP+THIGH+CHEST+FOREARM+ABDOMEN +WRIST, data = cleandata)
#Check assumptions
quartz(12,6)
par(mfrow = c(2,3))
plot(model3, which  = 1)
plot(model3, which  = 2)
plot(model3, which  = 3)
plot(model3, which  = 4)
plot(model3, which  = 5)
plot(model3, which  = 6)
#meets assumptions well
#Cp
model4 = lm(BODYFAT~AGE +HEIGHT+NECK+CHEST+FOREARM+ABDOMEN +WRIST, data = cleandata)
#Check assumptions
quartz(12,6)
par(mfrow = c(2,3))
plot(model4, which  = 1)
plot(model4, which  = 2)
plot(model4, which  = 3)
plot(model4, which  = 4)
plot(model4, which  = 5)
plot(model4, which  = 6)
#meets assumptions well
#meets assumptions well
#This part is written by Daiyi Shi
#Third part
#choose a model
#Compare with K-fold cross-validation errors
set.seed(1)
train.control <- trainControl(method = "cv", number = 5)
#This part is written by Daiyi Shi
#Third part
#choose a model
#Compare with K-fold cross-validation errors
library(caret)
set.seed(1)
train.control <- trainControl(method = "cv", number = 5)
cv1 <- train(model1$terms, data = cleandata, method = "lm",trControl = train.control)
cv1$results$RMSE
cv2 <- train(model2$terms, data = cleandata, method = "lm",trControl = train.control)
cv2$results$RMSE
cv3 <- train(model3$terms, data = cleandata, method = "lm",trControl = train.control)
cv3$results$RMSE
cv4 <- train(model4$terms, data = cleandata, method = "lm",trControl = train.control)
cv4$results$RMSE
#1st(AIC) has the lowest error.
#1st(AIC)'s error is not much less than 2nd(BIC)'s, but much more complicated
#Use anova to figure the significance of difference.
anova(model2,model1)
anova(model4,model1)
#p=0.00037<0.05, reject H0, which means adding those terms offers significant difference
#p=0.00037<0.05, reject H0, which means adding those terms offers significant difference
#to outcomes. So model1 is chosen.
#Use step() to select models with two-way interactions by AIC and BIC
lm0 <- lm(BODYFAT~1, data=cleandata)
lm1 <- lm(BODYFAT~ .*., data=cleandata)
#AIC
model1= step(lm0, scope = list(upper=lm1), direction = "both",k=2)
#Check assumptions and influential points
quartz(12,6)
par(mfrow = c(2,3))
plot(model1, which  = 1)
plot(model1, which  = 2)
plot(model1, which  = 3)
plot(model1, which  = 4)
plot(model1, which  = 5)
plot(model1, which  = 6)
